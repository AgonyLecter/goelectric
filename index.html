<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Scooter GoElectric</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100%;
            padding-top: 20px;
        }

        .logo {
            width: 150px;
            height: auto;
            margin-bottom: 20px; /* Ensure space between logo and list */
        }

        #scooterList {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 90%;
        }

        .scooter {
            margin-bottom: 10px;
        }

        .button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            color: white;
            background-color: #007BFF; /* More visible color */
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #endOfDayButton {
            margin-top: 20px; /* Space from list */
            font-weight: bold;
        }

        .available {
            background-color: #4CAF50; /* Green */
        }

        .rented {
            background-color: #f44336; /* Red */
        }

        .unlock {
            background-color: #f9a825; /* Yellow */
            color: black;
        }

        .button:hover {
            transform: scale(1.05);
        }

        #footer {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            animation: fadeInOut 10s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        #statusMessage, #countdown {
            margin-top: 10px;
            color: #333;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <img src="logo.png" class="logo" alt="GoElectric Logo">
    <div id="scooterList"></div>
    <button id="endOfDayButton" class="button">Fine Giornata</button>
    <div id="statusMessage"></div>
    <div id="countdown"></div>
    <div id="footer">
        Script by MichaleldettoDamianodettoFabrizio &reg;
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyC346gJHt-Dg7_bjzYw7k1D6j0tcalxht4",
  authDomain: "goelectric-e9299.firebaseapp.com",
  databaseURL: "https://goelectric-e9299-default-rtdb.firebaseio.com",
  projectId: "goelectric-e9299",
  storageBucket: "goelectric-e9299.appspot.com",
  messagingSenderId: "81618360543",
  appId: "1:81618360543:web:67a9a4d38ec18400c1316a",
  measurementId: "G-6FZQSDWEZJ"
        };
        firebase.initializeApp(firebaseConfig);

        document.addEventListener('DOMContentLoaded', function() {
    const dbRef = firebase.database().ref('scooters');
    const dateRef = firebase.database().ref('lastPressedDate');
    const endOfDayButton = document.getElementById('endOfDayButton');
    const statusMessage = document.getElementById('statusMessage');
    const countdown = document.getElementById('countdown');

    function updateStatus(lastPressed) {
        if (lastPressed) {
            const lastPressedDate = new Date(lastPressed); // Converte il timestamp in un oggetto Date
            statusMessage.textContent = `Ultimo aggiornamento: ${lastPressedDate.toLocaleString()}`;
        } else {
            statusMessage.textContent = "Nessun aggiornamento effettuato ancora oggi.";
        }
    }

    function updateCountdown() {
        const now = new Date();
        const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        const msLeft = tomorrow - now;
        const hours = Math.floor(msLeft / 1000 / 60 / 60);
        const minutes = Math.floor((msLeft / 1000 / 60) % 60);
        countdown.textContent = `Disponibile tra: ${hours} ore e ${minutes} minuti`;
        setTimeout(updateCountdown, 60000); // Aggiorna ogni minuto
    }

    dateRef.on('value', snapshot => {
        const lastPressedDate = snapshot.val();
        const today = new Date().toDateString();
        const lastPressed = new Date(lastPressedDate);
        endOfDayButton.disabled = lastPressed.toDateString() === today;
        updateStatus(lastPressedDate);
        if (endOfDayButton.disabled) {
            updateCountdown();
        } else {
            countdown.textContent = "";
        }
    });

    endOfDayButton.addEventListener('click', function() {
        const now = new Date();
        dateRef.set(now.toJSON()); // Salva l'orario corrente come JSON
        updateDaysRemaining();
        updateStatus(now.toJSON());
        updateCountdown();
    });


            function displayScooters() {
                dbRef.on('value', snapshot => {
                    const data = snapshot.val();
                    const container = document.getElementById('scooterList');
                    container.innerHTML = '';
                    Object.keys(data).forEach(key => {
                        const scooter = data[key];
                        const scooterElement = document.createElement('div');
                        scooterElement.className = 'scooter';

                        const statusButton = document.createElement('button');
                        statusButton.className = `button ${scooter.status === 'disponibile' ? 'available' : 'rented'}`;
                        statusButton.textContent = `${scooter.name} - ${scooter.status} - Giorni rimasti: ${scooter.daysRemaining}`;
                        scooterElement.appendChild(statusButton);

                        if (scooter.status === 'noleggiato') {
                            const unlockButton = document.createElement('button');
                            unlockButton.textContent = 'Sblocca';
                            unlockButton.className = 'button unlock';
                            unlockButton.onclick = () => unlockScooter(key, scooter);
                            scooterElement.appendChild(unlockButton);
                        } else {
                            statusButton.onclick = () => rentScooter(key, scooter);
                        }

                        container.appendChild(scooterElement);
                    });
                });
            }

            function updateDaysRemaining() {
                dbRef.once('value', snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const scooter = childSnapshot.val();
                        if (scooter.status === 'noleggiato' && scooter.daysRemaining > 0) {
                            const newDaysRemaining = scooter.daysRemaining - 1;
                            childSnapshot.ref.update({
                                daysRemaining: newDaysRemaining
                            });
                        }
                    });
                });
            }

            function rentScooter(key, scooter) {
                const days = prompt("Per quanti giorni sar√† noleggiato lo scooter?");
                if (days && !isNaN(days)) {
                    dbRef.child(key).update({
                        status: 'noleggiato',
                        daysRemaining: parseInt(days, 10)
                    });
                }
            }

            function unlockScooter(key, scooter) {
                dbRef.child(key).update({
                    status: 'disponibile',
                    daysRemaining: 0
                });
            }

            displayScooters();
        });
    </script>
</body>
</html>
