<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Scooter GoElectric</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f4f4f4;
            padding-top: 20px;
        }
        .logo {
            width: 150px;
            height: auto;
            margin-bottom: 20px;
        }
        #daysMenuModal .modal-content {
            font-family: 'Roboto', sans-serif;
        }
        .scooter-btn {
            width: 100%;
            margin: 5px 0;
        }
        .return-today {
            background-color: #f0ad4e; /* Bootstrap warning color for special attention */
        }
    </style>
</head>
<body>
    <div class="container d-flex flex-column align-items-center">
        <img src="logo.png" class="logo mb-3" alt="GoElectric Logo">
        <div id="navMenu" class="mb-3">
            <a href="reservations.html" class="btn btn-primary">Reservations</a>
        </div>
        <div id="scooterList" class="w-100 row"></div>
        <button id="endOfDayButton" class="btn btn-danger mt-3">Fine Giornata</button>
        <div id="statusMessage" class="mt-3"></div>
        <div id="countdown" class="mt-1"></div>
        <div id="footer" class="mt-3 text-secondary">
            &reg; Script by MichaeldettoDamianodettoFabrizio
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="daysMenuModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Seleziona i giorni o rientro giornaliero</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input id="daysInput" type="number" class="form-control" min="2" value="2">
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="returnToday">
                        <label class="form-check-label" for="returnToday">
                            Rientra oggi
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="submitDays()">Conferma</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyC346gJHt-Dg7_bjzYw7k1D6j0tcalxht4",
            authDomain: "goelectric-e9299.firebaseapp.com",
            databaseURL: "https://goelectric-e9299-default-rtdb.firebaseio.com",
            projectId: "goelectric-e9299",
            storageBucket: "goelectric-e9299.appspot.com",
            messagingSenderId: "81618360543",
            appId: "1:81618360543:web:67a9a4d38ec18400c1316a",
            measurementId: "G-6FZQSDWEZJ"
        };
        firebase.initializeApp(firebaseConfig);

        document.addEventListener('DOMContentLoaded', function() {
            const dbRef = firebase.database().ref('scooters');
            dbRef.on('value', snapshot => {
                const data = snapshot.val();
                const container = document.getElementById('scooterList');
                container.innerHTML = '';
                Object.keys(data).sort((a, b) => a - b).forEach(key => {
                    const scooter = data[key];
                    const scooterElement = document.createElement('div');
                    scooterElement.className = 'col-md-4 col-sm-6';
                    
                    const statusButton = document.createElement('button');
                    statusButton.className = `btn ${scooter.status === 'disponibile' ? 'btn-success' : scooter.status === 'rientra_oggi' ? 'return-today' : 'btn-danger'} scooter-btn`;
                    statusButton.textContent = scooter.status === 'rientra_oggi' ? `${scooter.name} - Rientra Oggi` : `${scooter.name} - ${scooter.status} - Giorni rimasti: ${scooter.daysRemaining}`;
                    
                    const actionButton = document.createElement('button');
                    actionButton.className = 'btn btn-secondary scooter-btn';
                    actionButton.textContent = scooter.status === 'noleggiato' || scooter.status === 'rientra_oggi' ? 'Sblocca' : 'Noleggia';
                    actionButton.onclick = () => {
                        if (scooter.status === 'noleggiato' || scooter.status === 'rientra_oggi') {
                            unlockScooter(key);
                        } else {
                            showDaysMenu(key);
                        }
                    };

                    scooterElement.appendChild(statusButton);
                    scooterElement.appendChild(actionButton);
                    container.appendChild(scooterElement);
                });
            });

            function showDaysMenu(key) {
                currentScooterKey = key;
                const daysMenuModal = new bootstrap.Modal(document.getElementById('daysMenuModal'));
                daysMenuModal.show();
            }

            window.submitDays = function() {
                const daysInput = document.getElementById('daysInput');
                const days = parseInt(daysInput.value, 10);
                const returnToday = document.getElementById('returnToday').checked;
                if (returnToday) {
                    dbRef.child(currentScooterKey).update({
                        status: 'rientra_oggi',
                        daysRemaining: 1
                    });
                } else {
                    dbRef.child(currentScooterKey).update({
                        status: 'noleggiato',
                        daysRemaining: days >= 2 ? days : 2
                    });
                }
                const daysMenuModal = bootstrap.Modal.getInstance(document.getElementById('daysMenuModal'));
                daysMenuModal.hide();
            };

            function unlockScooter(key) {
                dbRef.child(key).update({
                    status: 'disponibile',
                    daysRemaining: 0
                });
            }
        });
    </script>
</body>
</html>
